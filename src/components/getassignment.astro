---
import { supabase } from "../lib/backend";
import type { Question } from "../lib/db";

export interface Props {
    id: number
}

let { id } = Astro.props

async function getTitle() {
    let obj = (await supabase.from("Assignment").select("name").eq("id", id).limit(1)).data!
    if(obj.length == 0) {
        location.href = "/404"
    }
    let title = obj[0].name
    return title
}
async function getQuestions() {
    let questions: Question[] = (await supabase.from("Question").select("*").eq("assignment_id", id).order("number", { ascending: true })).data!
    return questions
}

let title = await getTitle()
let questions = await getQuestions()
---
<h1 class="text-white text-4xl 2xl:text-5xl text-center my-10">{title}</h1>
{questions.map(question => (
    <div class="flex flex-col items-center">
        <div class="flex flex-col items-center gap-y-5 my-5">
            <h2 class="text-white text-xl 2xl:text-3xl text-left w-[24rem] sm:w-[40rem]">{question.number}. {question.text}</h2>
            {question.is_file ?
                <div class="flex justify-center">
                    <img width="40%" alt="Answers" src={"https://tzkfqozchfdkixqkvmoo.supabase.co/storage/v1/object/public/answers/" + question.answer}>
            </div> :
                <h2 class="text-lg 2xl:text-2xl text-left w-[85%] sm:w-[36rem]"><span class=" text-blue-500">Answer: </span>{question.answer}</h2>
            }
        </div>
    </div>
))}
