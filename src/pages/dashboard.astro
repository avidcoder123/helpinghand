---
import Layout from "../layouts/Layout.astro";
import User from "../lib/user";

if(User.currentUser == undefined) {
    Astro.redirect("/")
}

//FOR DEVELOPMENT: Login user
try {
    await User.register()
} catch {
    await User.login()
}

//Get user's first name
let username = User.currentUser?.name.split(" ")[0]

let classes = await User.currentUser?.getClasses()

if(User.currentUser == undefined) {
    Astro.redirect("/")
}
---
<Layout title="Dashboard" loggedIn={true}>
    <h1 class="text-5xl text-center text-white mt-5">Welcome, {username}!</h1>
    <div class="flex flex-col gap-y-5 items-center mt-10">
        {classes?.map(c => (
            <div onclick={`location.replace("/class/${c.id}")`} style="cursor: pointer;" class="card bg-info-content w-7/12 h-20">
                <div class="card-body items-center justify-center">
                    <h1 class="card-title text-center">{c.name}</h1>
                </div>
            </div>
        ))}
    </div>
</Layout>